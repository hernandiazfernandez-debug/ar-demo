<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>HD3D AR Demo</title>

    <!-- A-Frame + MindAR -->
    <script src="https://cdn.jsdelivr.net/npm/aframe@1.4.0/dist/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

    <style>
      body { margin: 0; overflow: hidden; }

      #loading {
        position: fixed; top: 0; left: 0;
        width: 100%; height: 100%;
        background: #000; color: #fff;
        display: flex; align-items: center; justify-content: center;
        font-size: 20px; z-index: 5;
      }

      /* Video centrado en pantalla */
      #videoHD3D {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 100%;
        max-width: 600px;
        max-height: 100vh;
        background: #000;
        z-index: 20;
        display: none; /* se muestra al detectar el robot */
      }

      #mensajeSonido {
        position: fixed;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0,0,0,0.7);
        color: #fff;
        padding: 8px 14px;
        border-radius: 8px;
        font-size: 14px;
        z-index: 21;
        display: none;
      }
    </style>
  </head>

  <body>
    <div id="loading">Cargando cámara...</div>

    <!-- Video centrado, fuera de la escena AR -->
    <video id="videoHD3D"
           src="https://hernandiazfernandez-debug.github.io/ar-demo/Download.mp4"
           playsinline
           muted
           controls>
    </video>
    <div id="mensajeSonido">Toca el video una vez para activar el sonido</div>

    <!-- Escena AR solo para detectar el robot -->
    <a-scene mindar-image="imageTargetSrc: https://hernandiazfernandez-debug.github.io/ar-demo/RobotHD3D.mind;"
             color-space="sRGB"
             renderer="colorManagement: true, physicallyCorrectLights"
             vr-mode-ui="enabled: false"
             device-orientation-permission-ui="enabled: true">

      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <!-- Target del robot -->
      <a-entity mindar-image-target="targetIndex: 0"></a-entity>

    </a-scene>

    <script>
      window.addEventListener("DOMContentLoaded", () => {
        const loading = document.getElementById("loading");
        const scene = document.querySelector("a-scene");
        const target = document.querySelector("[mindar-image-target]");
        const video = document.getElementById("videoHD3D");
        const mensajeSonido = document.getElementById("mensajeSonido");

        // Ocultar "Cargando cámara" después de un rato
        setTimeout(() => {
          loading.style.display = "none";
        }, 2000);

        // Cuando MindAR está listo
        scene.addEventListener("arReady", () => {
          console.log("AR listo");
        });

        // Cuando la cámara ve el robot
        target.addEventListener("targetFound", () => {
          console.log("Robot detectado");
          video.style.display = "block";
          mensajeSonido.style.display = "block";
          video.play(); // se reproduce en silencio al inicio
        });

        // Si se pierde el robot, ocultamos el video
        target.addEventListener("targetLost", () => {
          console.log("Robot perdido");
          video.pause();
          video.currentTime = 0;
          video.style.display = "none";
          mensajeSonido.style.display = "none";
        });

        // Primer toque sobre el video: activar sonido
        let sonidoActivado = false;
        video.addEventListener("click", () => {
          if (!sonidoActivado) {
            video.muted = false;
            sonidoActivado = true;
            mensajeSonido.style.display = "none";
          }
        });
      });
    </script>
  </body>
</html>
